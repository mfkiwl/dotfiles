# vim: ft=bash

function prompt_command {
    local userprompt="$USER@$HOSTNAME"

    local workdir
    if [[ "$PWD" == "$HOME" ]]
    then
        workdir=" ~ "
    else
        workdir=" $(basename $PWD) "
    fi

    local venvprompt
    if [[ "$VIRTUAL_ENV" == "" ]]
    then
        venvprompt=""
    else
        venvprompt=" ($(basename $VIRTUAL_ENV))"
    fi

    local gitbranch=$(git rev-parse --abbrev-ref HEAD 2> /dev/null)
    local gitprompt
    if [[ "$gitbranch" == "" ]]
    then
        gitprompt=""
    else
        gitprompt=" <$(echo $gitbranch | cut -c-16)>"
    fi

    local width=$(tput cols)
    local width40pct=$(($width * 2 / 5))

    local left_simple="$userprompt$venvprompt$gitprompt$workdir"
    local left="$userprompt$CYAN$venvprompt$MAGENTA$gitprompt$YELLOW$workdir$NOCOLOR"
    local right="\$ "
    if [[ ${#left_simple} -gt $width40pct ]]
    then
        PS1="$left\n$right"
    else
        PS1="$left$right"
    fi
}

export PROMPT_COMMAND=prompt_command
